<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* === –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 2.2em;
            text-align: center;
        }

        /* === –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π === */
        h2 {
            color: #007bff;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.6em;
            opacity: 0.8;
            width: 100%;
        }

        /* === –û–±—â–∏–µ —Å—Ç–∏–ª–∏ —Å–µ–∫—Ü–∏–π —Ñ–æ—Ä–º—ã === */
        .form-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: #fcfcfc;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* === –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –±–ª–æ–∫–∞ === */
        #block-bio-clinical {
            background-color: #e8f5ff;
            border: 2px solid #007bff;
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.2);
            margin-bottom: 40px;
        }
        #block-bio-clinical h2 {
            color: #0056b3;
            font-size: 2em;
            border-bottom: 2px solid #007bff;
            opacity: 1;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        /* === –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π: –û–±—â–∏–µ —Å—Ç–∏–ª–∏ (–£–õ–£–ß–®–ï–ù–û –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï) === */
        .input-group {
            display: flex;
            flex-direction: column;
            /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ input-group –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é,
               —á—Ç–æ–±—ã label —Å –¥–ª–∏–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –Ω–µ —Å–¥–≤–∏–≥–∞–ª —Å–æ—Å–µ–¥–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
            align-items: flex-start;
        }

        /* === –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ë–õ–û–ö–ê 2 (–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è) === */
        #block-personalization {
            justify-content: flex-start;
            align-items: flex-start;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è INPUT (–†—É—á–Ω–æ–π –≤–≤–æ–¥): –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ —Å—Ç—Ä–æ–∫—É */
        #block-personalization .input-group:has(input[type="number"]) {
            flex: 0 0 250px;
            /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ —Å–∞–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä input-group */
            align-items: stretch;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è SELECT (–í—ã–±–æ—Ä): –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ —Å—Ç–æ–ª–±–µ—Ü */
        #block-personalization .input-group:has(select) {
            flex: 1 1 100%;
            max-width: 100%;
        }

        /* === –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã === */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 0.95em;
            width: 100%;
        }

        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            margin-bottom: 5px;
            font-size: 1em;
            /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –≤—ã—Å–æ—Ç–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞ */
            min-height: 40px;
        }

        /* === –ë–ª–æ–∫ 3: –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞ === */
        #block-initial-regimen {
            max-width: 650px;
            justify-content: flex-start;
        }
        #block-initial-regimen .input-group {
            flex: 1 1 250px;
        }

        /* --- –ü—Ä–æ—á–∏–µ —Å—Ç–∏–ª–∏ (Intro, –ö–Ω–æ–ø–∫–∞, –†–µ–∑—É–ª—å—Ç–∞—Ç—ã) --- (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) */
        .intro-text { background-color: #e9f7ef; border-left: 5px solid #28a745; padding: 15px 20px; border-radius: 8px; margin-bottom: 30px; font-size: 1.1em; color: #218838; }
        button { background-color: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background-color 0.3s, transform 0.2s; display: block; margin: 30px auto 0 auto; }
        button:hover { background-color: #218838; transform: translateY(-2px); }
        .results-section { display: flex; flex-wrap: wrap; gap: 30px; margin-top: 30px; }
        .regimen-card { flex: 1; min-width: 45%; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); }
        #optimal-regimen { background-color: #e6ffec; border: 2px solid #28a745; border-left: 8px solid #28a745; box-shadow: 0 8px 15px rgba(40, 167, 69, 0.2); }
        #initial-regimen { background-color: #f7f7f7; border: 1px solid #e9ecef; border-left: 3px solid #ced4da; }
        #optimal-regimen .metric-value { font-size: 28px; color: #0056b3; }
        #initial-regimen .metric-value { font-size: 20px; color: #868e96; }
        .metric-label { font-size: 14px; color: #6c757d; }
        .charts-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
        #treatment-recommendation { background-color: #ffe0b2; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid #ff9800; }
        #drug-check-message { margin-top: 10px; padding: 10px; border-radius: 5px; font-size: 16px; line-height: 1.4; }
        .correct { background-color: #e6ffe6; border-left: 4px solid #28a745; }
        .warning { background-color: #fff3cd; border-left: 4px solid #ffc107; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .charts-section { grid-template-columns: 1fr; }
            .regimen-card { min-width: 100%; }
            .form-section {
                flex-direction: column;
                align-items: center;
            }
            .input-group {
                 width: 100%;
                 max-width: 400px;
            }
            #block-initial-regimen {
                 max-width: 100%;
            }
            #block-initial-regimen .input-group {
                flex: 1 1 100%;
                max-width: 400px;
            }
            /* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –≤—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–æ–ª–±–µ—Ü */
            #block-personalization .input-group:has(input[type="number"]) {
                flex: 1 1 100%;
                max-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ü–ª–∞–Ω –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏</h1>

        <div class="intro-text">
            <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å —Ö–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞.</p>
            <p><strong>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞ (–ë–ª–æ–∫ 1).</strong></p>
        </div>

        <form id="optimization-form">

            <div class="form-section" id="block-bio-clinical">
                <h2>1. –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏ –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –î–∞–Ω–Ω—ã–µ</h2>
                <div class="input-group">
                    <label for="subtype">–ú–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã–π –ø–æ–¥—Ç–∏–ø</label>
                    <select id="subtype" required>
                        <option value="TNBC">TNBC (–¢—Ä–∏–∂–¥—ã-–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π)</option>
                        <option value="HR-HER2+">HR-HER2+</option>
                        <option value="HR+HER2+">HR+HER2+</option>
                        <option value="HR+HER2-" selected>HR+HER2- (–õ—é–º–∏–Ω–∞–ª—å–Ω—ã–π)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="ki67_level">–£—Ä–æ–≤–µ–Ω—å Ki-67 (%)</label>
                    <input type="number" id="ki67_level" value="8.0" min="1" max="100" step="0.1" required>
                </div>
                <div class="input-group">
                    <label for="tumor_size">–†–∞–∑–º–µ—Ä –æ–ø—É—Ö–æ–ª–∏ (—Å–º)</label>
                    <input type="number" id="tumor_size" value="1.5" min="0.1" max="15.0" step="0.1" required>
                </div>
            </div>

            ---

            <div class="form-section" id="block-personalization">
                 <h2>2. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è </h2>

                <div class="input-group">
                    <label for="age">–í–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞ </label>
                    <input type="number" id="age" value="60" min="18" max="100" required>
                </div>
                <div class="input-group">
                    <label for="patient_stage">–°—Ç–∞–¥–∏—è –†–ú–ñ </label>
                    <input type="number" id="patient_stage" value="1" min="1" max="4" required>
                </div>

                <div class="input-group">
                    <label for="chemo_drug">–ü—Ä–µ–ø–∞—Ä–∞—Ç –¥–ª—è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏</label>
                    <select id="chemo_drug" required>
                        <option value="NotApplicable">–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</option>
                        <option value="Doxorubicin" selected>–î–æ–∫—Å–æ—Ä—É–±–∏—Ü–∏–Ω</option>
                        <option value="Paclitaxel">–ü–∞–∫–ª–∏—Ç–∞–∫—Å–µ–ª</option>
                        <option value="Carboplatin">–ö–∞—Ä–±–æ–ø–ª–∞—Ç–∏–Ω</option>
                        <option value="Cyclophosphamide">–¶–∏–∫–ª–æ—Ñ–æ—Å—Ñ–∞–º–∏–¥</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="target_drug">–ü—Ä–µ–ø–∞—Ä–∞—Ç –¥–ª—è –¢–∞—Ä–≥–µ—Ç–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)</label>
                    <select id="target_drug" required>
                        <option value="None" selected>–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</option>
                        <option value="Trastuzumab">–¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±</option>
                        <option value="Pertuzumab">–ü–µ—Ä—Ç—É–∑—É–º–∞–±</option>
                        <option value="Lapatinib">–õ–∞–ø–∞—Ç–∏–Ω–∏–±</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="ecog_status">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å ECOG (0-4, –í–ª–∏—è–Ω–∏–µ –Ω–∞ –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å)</label>
                    <select id="ecog_status" required>
                        <option value="0" selected>0: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–∫—Ç–∏–≤–µ–Ω</option>
                        <option value="1">1: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç—è–∂–µ–ª–æ–π —Ñ–∏–∑. –Ω–∞–≥—Ä—É–∑–∫–∏</option>
                        <option value="2">2: –í–Ω–µ –∫—Ä–æ–≤–∞—Ç–∏ > 50% –≤—Ä–µ–º–µ–Ω–∏</option>
                        <option value="3">3: –í –∫—Ä–æ–≤–∞—Ç–∏ –∏–ª–∏ –∫—Ä–µ—Å–ª–µ > 50% –≤—Ä–µ–º–µ–Ω–∏</option>
                        <option value="4">4: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏–∫–æ–≤–∞–Ω –∫ –ø–æ—Å—Ç–µ–ª–∏</option>
                    </select>
                </div>
            </div>

            ---

            <div class="form-section" id="block-initial-regimen">
                <h2>3. –ò—Å—Ö–æ–¥–Ω–∞—è (–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è) –°—Ö–µ–º–∞ (6 —Ü–∏–∫–ª–æ–≤)</h2>
                <div class="input-group">
                    <label for="initial_dose">–î–æ–∑–∞ (–º–≥)</label>
                    <input type="number" id="initial_dose" value="200.0" min="10" step="10.0" required>
                </div>
                <div class="input-group">
                    <label for="initial_interval">–ò–Ω—Ç–µ—Ä–≤–∞–ª (–¥–Ω–∏)</label>
                    <input type="number" id="initial_interval" value="14.0" min="7" step="1.0" required>
                </div>
            </div>

            <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ü—Ä–æ–≥–Ω–æ–∑ –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é</button>
        </form>

        <div id="loading" style="display:none; color:#007bff; font-weight:bold; margin-top: 20px; text-align: center; font-size: 1.2em;">
            –†–∞—Å—á–µ—Ç, –ø—Ä–æ–≥–Ω–æ–∑ –ª–µ—á–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è...
        </div>

        <div id="results" style="display:none;">
            <hr style="margin-top: 40px; margin-bottom: 40px; border-color: #e0e0e0;">

            <div id="treatment-recommendation">
                <h3>üîç –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¢–∏–ø –õ–µ—á–µ–Ω–∏—è</h3>
                <p style="font-size: 20px; font-weight: bold; color: #007bff;" id="recommended-treatment"></p>
                <p id="treatment-message" style="color: #555;"></p>
                <div id="drug-check-message"></div>
            </div>

            <div id="optimization-results">
                <h2>‚úîÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏ (6 —Ü–∏–∫–ª–æ–≤)</h2>
                <div class="results-section">
                    <div class="regimen-card" id="optimal-regimen">
                        <h3>–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –°—Ö–µ–º–∞</h3>
                        <p class="metric-label">–î–æ–∑–∞ / –ò–Ω—Ç–µ—Ä–≤–∞–ª / –¶–∏–∫–ª—ã:</p>
                        <p class="metric-value">
                            <span id="opt-dose"></span> –º–≥ /
                            <span id="opt-interval"></span> –¥–Ω–µ–π / <span id="opt-cycles"></span> —Ü–∏–∫–ª–æ–≤
                        </p>

                        <p class="metric-label"><strong>–û–±—â–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è:</strong></p>
                        <p class="metric-value"><span id="opt-total-time"></span> –¥–Ω–µ–π</p>

                        <p class="metric-label">–ü—Ä–æ–≥–Ω–æ–∑: –ö–æ–Ω–µ—á–Ω—ã–π –æ–±—ä–µ–º –æ–ø—É—Ö–æ–ª–∏:</p>
                        <p class="metric-value"><span id="opt-v-total"></span> —Å–º¬≥</p>

                        <p class="metric-label">–ü—Ä–æ–≥–Ω–æ–∑: –°–æ–≤–æ–∫—É–ø–Ω–æ–µ –≤—Ä–µ–º—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏:</p>
                        <p class="metric-value"><span id="opt-tox-time"></span> –¥–Ω–µ–π</p>
                    </div>

                    <div class="regimen-card" id="initial-regimen">
                        <h3>–ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è –ò—Å—Ö–æ–¥–Ω–æ–π –°—Ö–µ–º—ã (6 —Ü–∏–∫–ª–æ–≤)</h3>
                        <p class="metric-label">–î–æ–∑–∞ / –ò–Ω—Ç–µ—Ä–≤–∞–ª / –¶–∏–∫–ª—ã:</p>
                        <p class="metric-value">
                             <span id="init-dose"></span> –º–≥ /
                            <span id="init-interval"></span> –¥–Ω–µ–π / <span id="init-cycles"></span> —Ü–∏–∫–ª–æ–≤
                        </p>

                        <p class="metric-label"><strong>–û–±—â–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–µ—á–µ–Ω–∏—è:</strong></p>
                        <p class="metric-value"><span id="init-total-time"></span> –¥–Ω–µ–π</p>

                        <p class="metric-label">–ü—Ä–æ–≥–Ω–æ–∑: –ö–æ–Ω–µ—á–Ω—ã–π –æ–±—ä–µ–º –æ–ø—É—Ö–æ–ª–∏:</p>
                        <p class="metric-value"><span id="init-v-total"></span> —Å–º¬≥</p>

                        <p class="metric-label">–ü—Ä–æ–≥–Ω–æ–∑: –°–æ–≤–æ–∫—É–ø–Ω–æ–µ –≤—Ä–µ–º—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏:</p>
                        <p class="metric-value"><span id="init-tox-time"></span> –¥–Ω–µ–π</p>
                    </div>
                </div>

                <hr style="margin-top: 40px; margin-bottom: 40px; border-color: #e0e0e0;">
                <h2>–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ê–Ω–∞–ª–∏–∑</h2>
                <div class="charts-section">
                    <div>
                        <canvas id="tumorChart"></canvas>
                    </div>
                    <div>
                        <canvas id="pkChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Chart.js –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        let tumorChart = null;
        let pkChart = null;
        const fixedCycles = 6;

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('optimization-form');
            const loading = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            const drugCheckMessageDiv = document.getElementById('drug-check-message');

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                loading.style.display = 'block';
                resultsDiv.style.display = 'none';

                // –°–±–æ—Ä –∏ –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö
                const initialDose = parseFloat(document.getElementById('initial_dose').value);
                const initialInterval = parseFloat(document.getElementById('initial_interval').value);
                const selectedChemoDrug = document.getElementById('chemo_drug').value;
                const selectedTargetDrug = document.getElementById('target_drug').value;

                const inputData = {
                    patient_data: {
                        tumor_size_cm: parseFloat(document.getElementById('tumor_size').value),
                        subtype: document.getElementById('subtype').value,
                        ki67_level: parseFloat(document.getElementById('ki67_level').value),
                        age: parseInt(document.getElementById('age').value),
                        patient_stage: parseInt(document.getElementById('patient_stage').value),
                        ecog_status: parseInt(document.getElementById('ecog_status').value),
                        chemo_drug: selectedChemoDrug,
                        target_drug: selectedTargetDrug
                    },
                    initial_regimen: {
                        dose: initialDose,
                        interval: initialInterval
                    }
                };

                // –ò–ú–ò–¢–ê–¶–ò–Ø –í–´–ó–û–í–ê API: –ó–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤
                const response = mockBackendCall(inputData);

                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ "–ó–∞–≥—Ä—É–∑–∫–∏")
                setTimeout(() => {
                    displayResults(response, inputData.initial_regimen);
                    loading.style.display = 'none';
                    resultsDiv.style.display = 'block';
                }, 800);
            });


            /**
             * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –º–æ–ª–µ–∫—É–ª—è—Ä–Ω–æ–º—É –ø–æ–¥—Ç–∏–ø—É –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–º—É –ª–µ—á–µ–Ω–∏—é.
             */
            function checkDrugSuitability(subtype, chemoDrug, targetDrug, predictedTreatment) {
                let checkMessage = '';
                let className = '';
                let messages = [];

                const is_her2_positive = subtype.includes("HER2+");
                const chemoRequired = predictedTreatment.includes("–•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è");

                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–∞—Ä–≥–µ—Ç–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏
                if (is_her2_positive) {
                    if (targetDrug === "None" || targetDrug === "Lapatinib") {
                        messages.push(`‚ö†Ô∏è –¢–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è: –î–ª—è ${subtype} –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã –¢—Ä–∞—Å—Ç—É–∑—É–º–∞–±/–ü–µ—Ä—Ç—É–∑—É–º–∞–±. –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç (${targetDrug === 'None' ? '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' : targetDrug}) –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª–µ–Ω.`);
                    } else {
                        messages.push(`‚úÖ –¢–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è: –í—ã–±—Ä–∞–Ω ${targetDrug}, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –¥–ª—è ${subtype}.`);
                    }
                } else if (!is_her2_positive && targetDrug !== "None") {
                    messages.push(`‚ö†Ô∏è –¢–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è: –î–ª—è ${subtype} (–Ω–µ HER2+) —Ç–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è –Ω–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ".`);
                }

                // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏
                if (chemoRequired) {
                    if (chemoDrug === "NotApplicable") {
                        messages.push(`‚ö†Ô∏è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –î–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏ –≤—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ". –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –î–æ–∫—Å–æ—Ä—É–±–∏—Ü–∏–Ω).`);
                    } else if (subtype === "TNBC" && chemoDrug !== "Carboplatin") {
                        messages.push(`‚ö†Ô∏è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –î–ª—è TNBC —á–∞—Å—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ö–∞—Ä–±–æ–ø–ª–∞—Ç–∏–Ω. –í—ã–±—Ä–∞–Ω–Ω—ã–π ${chemoDrug} –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω.`);
                    } else if (subtype === "HR+HER2-" && chemoDrug !== "Doxorubicin" && chemoDrug !== "Paclitaxel") {
                        messages.push(`‚ö†Ô∏è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –î–ª—è –ª—é–º–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ ${chemoDrug} –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª–µ–Ω.`);
                    } else {
                         messages.push(`‚úÖ –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –í—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–ø–∞—Ä–∞—Ç ${chemoDrug} —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—â–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º.`);
                    }
                } else if (!chemoRequired && chemoDrug !== "NotApplicable") {
                    messages.push(`‚ö†Ô∏è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –°–∏—Å—Ç–µ–º–Ω–∞—è –•–¢ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –ª–µ—á–µ–Ω–∏—è. –í—ã–±–µ—Ä–∏—Ç–µ "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ".`);
                } else if (!chemoRequired && chemoDrug === "NotApplicable") {
                    messages.push(`‚úÖ –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è: –í—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç "–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ", —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É –ª–µ—á–µ–Ω–∏—è.`);
                }


                checkMessage = messages.map(m => `<p>${m}</p>`).join('');

                if (checkMessage.includes('‚ö†Ô∏è')) {
                    className = 'warning';
                } else if (checkMessage) {
                    className = 'correct';
                }

                return { message: checkMessage, className: className };
            }


            /**
             * –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—á–µ—Ç –§–ö/–§–î –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Å—Ö–µ–º—ã.
             */
            function mockBackendCall(data) {
                const { tumor_size_cm, subtype, ki67_level, age, patient_stage, ecog_status, chemo_drug } = data.patient_data;
                const { dose: initial_dose, interval: initial_interval } = data.initial_regimen;
                const totalCycles = fixedCycles;

                // 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ª–µ—á–µ–Ω–∏—è (–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)
                let recommendedTreatment = "–•–∏—Ä—É—Ä–≥–∏—è";
                let treatmentMessage = "–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –ø–µ—Ä–≤–∏—á–Ω–∞—è —Ö–∏—Ä—É—Ä–≥–∏—è. –°–∏—Å—Ç–µ–º–Ω–∞—è —Ö–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.";

                const ki67Threshold = 15;
                const sizeThreshold = 2.0;
                const isAggressive = ki67_level > ki67Threshold || tumor_size_cm >= sizeThreshold;

                if (subtype === "TNBC") {
                    recommendedTreatment = "–ù–µ–æ–∞–¥—ä—é–≤–∞–Ω—Ç–Ω–∞—è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è + –•–∏—Ä—É—Ä–≥–∏—è";
                    treatmentMessage = "–í—ã—Å–æ–∫–æ–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–¥—Ç–∏–ø. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ–æ–∞–¥—ä—é–≤–∞–Ω—Ç–Ω–∞—è —Ö–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è.";
                } else if (subtype.includes("HER2+")) {
                    recommendedTreatment = "–ù–µ–æ–∞–¥—ä—é–≤–∞–Ω—Ç–Ω–∞—è –•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è + –¢–∞—Ä–≥–µ—Ç–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è + –•–∏—Ä—É—Ä–≥–∏—è";
                    treatmentMessage = "HER2-–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–¥—Ç–∏–ø. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Ö–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏–∏ –∏ –∞–Ω—Ç–∏-HER2 —Ç–∞—Ä–≥–µ—Ç–Ω–æ–π —Ç–µ—Ä–∞–ø–∏–∏.";
                } else if (subtype === "HR+HER2-" && isAggressive) {
                    recommendedTreatment = "–•–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—è (–ê–¥—ä—é–≤–∞–Ω—Ç–Ω–∞—è) + –ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è + –•–∏—Ä—É—Ä–≥–∏—è";
                    treatmentMessage = `–õ—é–º–∏–Ω–∞–ª—å–Ω—ã–π —Ç–∏–ø —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç–∏. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–¥—ä—é–≤–∞–Ω—Ç–Ω—É—é —Ö–∏–º–∏–æ—Ç–µ—Ä–∞–ø–∏—é.`;
                }

                // 2. –§–∞—Ä–º–∞–∫–æ–∫–∏–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è/–§–∞—Ä–º–∞–∫–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ú–æ–¥–µ–ª—å (–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è)

                // –ù–∞—á–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –≤ —Å–º¬≥
                const V_initial = (4/3) * Math.PI * Math.pow(tumor_size_cm / 2, 3);
                // –†–æ—Å—Ç –æ–ø—É—Ö–æ–ª–∏ (PD)
                const alpha = subtype === "TNBC" ? 0.05 : subtype.includes("HER2+") ? 0.04 : ki67_level / 1000;
                // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ (PD)
                const beta = chemo_drug === "Doxorubicin" ? 0.15 : chemo_drug === "Paclitaxel" ? 0.12 : 0.1;

                // –§–ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞)
                const clearance_base = chemo_drug === "Doxorubicin" ? 50 : 30;
                const clearance_factor = 1 + (age - 60) * 0.01;
                const clearance = clearance_base / clearance_factor;
                const dose_max_tolerated = 250;

                // –£—Ä–æ–≤–µ–Ω—å —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç ECOG –∏ –¥–æ–∑—ã)
                const tox_base = ecog_status * 0.5;
                // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç "–ü–æ—Ç–µ—Ä–∏" —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (Loss) –∏–∑-–∑–∞ —Å—Ç–∞–¥–∏–∏
                const loss_factor = 1 + (patient_stage - 1) * 0.1;


                // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º—ã (–î–æ–∑–∞/–ò–Ω—Ç–µ—Ä–≤–∞–ª)
                function calculateRegimen(dose, interval) {
                    let V_current = V_initial;
                    let V_trajectory = [V_initial];
                    let Cmax_trajectory = [];
                    let tox_total = 0;

                    const tox_factor = (dose / dose_max_tolerated) * 1.5;
                    const tox_rate = tox_base + tox_factor; // –î–Ω–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∑–∞ —Ü–∏–∫–ª

                    for (let i = 0; i < totalCycles; i++) {
                        const T_cycle = interval;

                        // –ü–ö: –†–∞—Å—á–µ—Ç Cmax (–£–ø—Ä–æ—â–µ–Ω–Ω–æ)
                        const Cmax = dose / clearance;
                        Cmax_trajectory.push(Cmax);

                        // –ü–î: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –æ–ø—É—Ö–æ–ª–∏
                        const reduction_factor = 1 - beta * Cmax * loss_factor;
                        // –°–Ω–∏–∂–µ–Ω–∏–µ + –†–æ—Å—Ç
                        V_current = V_current * reduction_factor + alpha * V_current * T_cycle;
                        V_trajectory.push(Math.max(0.001, V_current));

                        // –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
                        tox_total += tox_rate;
                    }

                    return {
                        V_total: V_current,
                        tox_time: tox_total,
                        total_time: totalCycles * interval,
                        V_trajectory: V_trajectory,
                        Cmax_trajectory: Cmax_trajectory
                    };
                }

                // 3. –†–∞—Å—á–µ—Ç –¥–ª—è –ò–°–•–û–î–ù–û–ô –°–•–ï–ú–´
                const initial_results_raw = calculateRegimen(initial_dose, initial_interval);

                // 4. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø
                let best_V_total = initial_results_raw.V_total;
                let optimal_dose = initial_dose;
                let optimal_interval = initial_interval;
                let optimal_results_raw = initial_results_raw;

                const max_tolerated_tox_days = 20 + ecog_status * 5; // –£—Å–ª–æ–≤–Ω—ã–π –ª–∏–º–∏—Ç —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏

                // –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –¥–æ–∑–µ (¬± 20% –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π) –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É (¬± 7 –¥–Ω–µ–π –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ)
                const doses_to_test = new Set();
                for (let d = initial_dose * 0.8; d <= initial_dose * 1.2; d += 10) doses_to_test.add(Math.round(d));

                const intervals_to_test = new Set();
                for (let i = initial_interval - 3; i <= initial_interval + 3; i += 1) intervals_to_test.add(Math.round(i));

                for (const dose_attempt of Array.from(doses_to_test).filter(d => d >= 10 && d <= dose_max_tolerated)) {
                    for (const interval_attempt of Array.from(intervals_to_test).filter(i => i >= 7 && i <= 28)) {

                        const current_attempt = calculateRegimen(dose_attempt, interval_attempt);

                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –¢–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç
                        if (current_attempt.tox_time <= max_tolerated_tox_days) {
                            if (current_attempt.V_total < best_V_total) {
                                best_V_total = current_attempt.V_total;
                                optimal_dose = dose_attempt;
                                optimal_interval = interval_attempt;
                                optimal_results_raw = current_attempt;
                            }
                        }
                    }
                }


                return {
                    initial: {
                        dose: initial_dose,
                        interval: initial_interval,
                        V_total: initial_results_raw.V_total.toFixed(3),
                        tox_time: initial_results_raw.tox_time.toFixed(1),
                        total_time: initial_results_raw.total_time.toFixed(0),
                        V_trajectory: initial_results_raw.V_trajectory,
                        Cmax_trajectory: initial_results_raw.Cmax_trajectory
                    },
                    optimal: {
                        dose: optimal_dose.toFixed(1),
                        interval: optimal_interval.toFixed(1),
                        V_total: optimal_results_raw.V_total.toFixed(3),
                        tox_time: optimal_results_raw.tox_time.toFixed(1),
                        total_time: optimal_results_raw.total_time.toFixed(0),
                        V_trajectory: optimal_results_raw.V_trajectory,
                        Cmax_trajectory: optimal_results_raw.Cmax_trajectory
                    },
                    recommended_treatment: recommendedTreatment,
                    treatment_message: treatmentMessage
                };
            }

            /**
             * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫–∏.
             */
            function displayResults(data, initialRegimen) {
                // 1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ª–µ—á–µ–Ω–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
                document.getElementById('recommended-treatment').textContent = data.recommended_treatment;
                document.getElementById('treatment-message').textContent = data.treatment_message;

                const subtype = document.getElementById('subtype').value;
                const chemoDrug = document.getElementById('chemo_drug').value;
                const targetDrug = document.getElementById('target_drug').value;
                const drugCheck = checkDrugSuitability(subtype, chemoDrug, targetDrug, data.recommended_treatment);

                drugCheckMessageDiv.innerHTML = drugCheck.message;
                drugCheckMessageDiv.className = drugCheck.className;


                // 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

                // –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞
                document.getElementById('opt-dose').textContent = data.optimal.dose;
                document.getElementById('opt-interval').textContent = data.optimal.interval;
                document.getElementById('opt-cycles').textContent = fixedCycles;
                document.getElementById('opt-v-total').textContent = data.optimal.V_total;
                document.getElementById('opt-tox-time').textContent = data.optimal.tox_time;
                document.getElementById('opt-total-time').textContent = data.optimal.total_time;

                // –ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞
                document.getElementById('init-dose').textContent = data.initial.dose.toFixed(1);
                document.getElementById('init-interval').textContent = data.initial.interval.toFixed(1);
                document.getElementById('init-cycles').textContent = fixedCycles;
                document.getElementById('init-v-total').textContent = data.initial.V_total;
                document.getElementById('init-tox-time').textContent = data.initial.tox_time;
                document.getElementById('init-total-time').textContent = data.initial.total_time;


                // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
                updateCharts(data);
            }

            /**
             * –°—Ç—Ä–æ–∏—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫–∏ Chart.js.
             */
            function updateCharts(data) {
                const cycles = Array.from({length: fixedCycles + 1}, (_, i) => `–¶–∏–∫–ª ${i}`);
                const CmaxCycles = Array.from({length: fixedCycles}, (_, i) => `–¶–∏–∫–ª ${i+1}`);

                // –ì—Ä–∞—Ñ–∏–∫ –æ–±—ä–µ–º–∞ –æ–ø—É—Ö–æ–ª–∏
                const tumorCtx = document.getElementById('tumorChart').getContext('2d');
                if (tumorChart) tumorChart.destroy(); // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ

                tumorChart = new Chart(tumorCtx, {
                    type: 'line',
                    data: {
                        labels: cycles,
                        datasets: [
                            {
                                label: '–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –°—Ö–µ–º–∞ (–û–±—ä–µ–º, —Å–º¬≥)',
                                data: data.optimal.V_trajectory,
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: '–ò—Å—Ö–æ–¥–Ω–∞—è –°—Ö–µ–º–∞ (–û–±—ä–µ–º, —Å–º¬≥)',
                                data: data.initial.V_trajectory,
                                borderColor: '#868e96',
                                backgroundColor: 'rgba(220, 53, 69, 0.05)',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '–î–∏–Ω–∞–º–∏–∫–∞ –û–±—ä–µ–º–∞ –û–ø—É—Ö–æ–ª–∏ (–ú–æ–¥–µ–ª—å PD)',
                                font: { size: 18 }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: '–û–±—ä–µ–º –û–ø—É—Ö–æ–ª–∏ (—Å–º¬≥)'
                                },
                                beginAtZero: true
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: '–¶–∏–∫–ª—ã –õ–µ—á–µ–Ω–∏—è'
                                }
                            }
                        }
                    }
                });

                // –ì—Ä–∞—Ñ–∏–∫ –ü–ö (Cmax)
                const pkCtx = document.getElementById('pkChart').getContext('2d');
                if (pkChart) pkChart.destroy(); // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ

                pkChart = new Chart(pkCtx, {
                    type: 'bar',
                    data: {
                        labels: CmaxCycles,
                        datasets: [
                            {
                                label: '–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –°—Ö–µ–º–∞ (Cmax)',
                                data: data.optimal.Cmax_trajectory,
                                backgroundColor: '#007bff',
                                borderColor: '#007bff',
                                borderWidth: 1
                            },
                            {
                                label: '–ò—Å—Ö–æ–¥–Ω–∞—è –°—Ö–µ–º–∞ (Cmax)',
                                data: data.initial.Cmax_trajectory,
                                backgroundColor: '#ced4da',
                                borderColor: '#adb5bd',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ (Cmax, –ú–æ–¥–µ–ª—å PK)',
                                font: { size: 18 }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Cmax (–£—Å–ª–æ–≤–Ω—ã–µ –ï–¥.)'
                                },
                                beginAtZero: true
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: '–¶–∏–∫–ª—ã –õ–µ—á–µ–Ω–∏—è'
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
